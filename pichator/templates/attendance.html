{% extends 'base.html' %}


{% block title %}Docházka{% endblock %}

{% block content %}

{% block scripts %}
<script>
    var pvs = [];

    function refresh_dept() {
        i = 0
        if ($('#pvs')[0].length != 1) {
            i = $('#pvs')[0].selectedIndex;
        }
        $('#dept')[0].value = pvs[i].dept;
    }

    function get_att_data() {
        i = 0
        if ($('#pvs')[0].length != 1) {
            i = $('#pvs')[0].selectedIndex;
        }
        $.ajax({
            url: '/attendance_data',
            headers: {
                'X-pvid': pvs[i].PV,
                'X-period': $("#period").val()
            }
        }).done(function (data) {
            //TODO render results of get_attendence
            var rows = data.data
            $('#attendance').empty();
            for (i = 0; i < rows.length; i++) {
                $('#attendance').append('<div class="row"><div class="col-xs-1"><input class="form-control" value="' + rows[i].day + '" id="day' + i +
                    '" readonly></div><div class="col-xs-1"><input class="form-control" value="' + rows[i].start + '" id=start"' + i + 
                    '></div><div class="col-xs-1"><input class="form-control" value="' + rows[i].end + '" id=end"' + i + 
                    '></div><div class="col-xs-1"><input class="form-control" value="' + rows[i].mode + '" id=mode"' + i + 
                    '></div><div class="col-xs-1"><input class="form-control" value="' + rows[i].weekday + '" id=weekday"' + i + 
                    '></div><div class="col-xs-1"><input class="form-control" value="' + rows[i].timetable + '" id=timetable"' + i + 
                    '></div></div>')
            }
        });
    }

    $(document).ready(function () {
        $('#period').datepicker({
            viewMode: 'months',
            format: 'mm-yyyy',
            minViewMode: 'months',
        });
        $("#period").datepicker().on('changeDate', function (e) {
            $.ajax({
                url: '/pvs',
                headers: {
                    'X-period': $("#period").val()
                }
            }).done(function (data) {
                $('#pvs').empty();
                pvs = data.data
                for (i = 0; i < pvs.length; i++) {
                    $('#pvs').append('<option value = ' + pvs[i].PV + '>' + pvs[i].PV +
                        '</option>')
                }
                refresh_dept();
                $('#pvs').selectpicker('refresh');
                get_att_data();
            });
        });
        $('#period').datepicker('setDate', new Date());
        $("#pvs").selectpicker();
        $("#pvs").selectpicker().on('change', function (e) {
            refresh_dept();
            get_att_data();
        });
    });
</script>
{% endblock %}
<div class='container-fluid'>
    <div class='row buffer-top-md'>
        <div class='col-md-8'>
            <form class='align-items-center form-inline' id='attendance-form' method='post'>
                <div class='row'>
                    <div class='form-group col-sm-1'>
                        <label for='period'>Období:</label>
                        <input class='form-control' name='period' id="period" type='text'>
                    </div>
                    <div class='form-group col-sm-1'>
                        <label for='pvs'>PV:</label>
                        <select class='form-control' name='pvs' id="pvs"></select>
                    </div>
                    <div class='form-group col-sm-1'>
                        <label for=''>Oddělení:</label>
                        <input class='form-control' id='dept' name='dept' type='text' readonly>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <form class='form form-group' id='attendance' name='attendance'>

    </form>
</div>
{% endblock %}