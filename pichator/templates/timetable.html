{% extends 'base.html' %}


{% block title %}Úprava pracovní doby{% endblock %}

{% block content %}

{% block scripts %}
<script>
    timetable = []

    function load_data() {
        emp_no = '{{ emp_no }}'
        //reload data and refresh textfields
        $.ajax({
            'url': '/timetable_data/' + emp_no,
        }).fail(function () {
            //#TODO display error
        }).always(function () {
            //#TODO remove loading image
        })
    }

    function on_select_pv() {
        i = $('#pvs').selectedIndex
        $('#occupancy').html('Úvazek' + timetable[i].dept)
        $('#dept').html('Oddělení' + timetable[i].occupancy)
        $('#monF').value(timetable[i].days[0])
        $('#monT').value(timetable[i].days[1])
        $('#tueF').value(timetable[i].days[2])
        $('#tueT').value(timetable[i].days[3])
        $('#wedF').value(timetable[i].days[4])
        $('#wedT').value(timetable[i].days[5])
        $('#thuF').value(timetable[i].days[6])
        $('#thuT').value(timetable[i].days[7])
        $('#friF').value(timetable[i].days[8])
        $('#friT').value(timetable[i].days[9])
    }
    $(document).ready(function () {
        load_data().done(function (data) {
            //#TODO process ajax data
            timetable = JSON.parse(data).data;
            for (i = 0; i < timetable.length; i++) {
                if (i == 0) {
                    $('#pvs').append('<option value="' + timetable[i].PV + '" id="' + timetable[i].PV +
                        '" selected="selected">' + timetable[i].PV + '</option>')
                } else {
                    $('#pvs').append('<option value="' + timetable[i].PV + '" id="' + timetable[i].PV +
                        '">' + timetable[i].PV + '</option>')
                }
            }
            on_select_pv();
        })
    })
</script>
{% endblock %}

<div class='container-fluid'>
    <div class='row-buffer-top-md'>
        <div class='col-md-7'>
            <h2>PV: </h2>
            <select id="pvs" onchange="on_select_pv();"></select>
            <h2 id='occupancy'></h2>
            <h2 id='dept'></h2>
            <form id='timetable-form'>
                Po: <input type='time' id='monF'> - <input type='time' id='monT'><br>
                Út: <input type='time' id='tueF'> - <input type='time' id='tueT'><br>
                St: <input type='time' id='wedF'> - <input type='time' id='wedT'><br>
                Čt: <input type='time' id='thuF'> - <input type='time' id='thuT'><br>
                Pá: <input type='time' id='friF'> - <input type='time' id='friT'><br>
                <button type='submit' class='pull-left btn btn-success submit-btn'>Uložit</button>
                <button id='btn-cancel' class='pull-right btn btn-warning' onclick='load_data();'>Zrušit</button>
            </form>

        </div>
    </div>

    {% endblock %}